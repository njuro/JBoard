<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{base}"
      th:with="label=${thread.getBoard().getLabel()}">
<head>
    <title th:text="|/${label}/ - Thread|">Thread</title>
</head>
<body>
<main layout:fragment="content">
    <th:block layout:insert="~{fragments/forms/reply-form :: reply-form(${label})}"/>

    <th:block layout:fragment="thread(thread)">
        <div class="ui divided items thread">
            <!--/*@thymesVar id="thread" type="com.github.njuro.jboard.models.Thread"*/-->
            <!--/*@thymesVar id="post" type="com.github.njuro.jboard.models.Post"*/-->
            <div th:each="post, iter: ${thread.posts}" class="item"
                 th:classappend="${iter.first}? 'original-post' : 'post'"
                 th:object="${post}" th:inline="text">
                <div class="ui top aligned image">
                    <a th:if="*{attachment != null}" th:href="*{attachment.url}" target="_blank">
                        <img th:object="${post.attachment}" th:src="*{url}"
                             th:style="|height: *{thumbHeight}px; width:*{thumbWidth}px|"/>
                    </a>
                </div>
                <div class="content">
                    <div class="meta">
                        <span class="name" th:text="*{name}">Anonymous</span>
                        <span class="tripcode" th:text="*{tripcode}">!tr1pc0d3</span>
                        <span class="subject" th:if="${iter.first}" th:text="${thread.subject}"></span>
                        <span class="date" th:text="*{#temporals.format(createdAt, 'dd.MM.yyyy HH:mm:ss')}"></span>
                        <span class="file" th:if="*{attachment != null}">
                            <em th:text="|File: *{attachment.originalFilename} (*{attachment.width}x*{attachment.height})|"></em>
                        </span>
                        <span class="post-number" th:text="'No. ' + *{postNumber}"></span>
                        <button class="circular mini ui basic icon button reply-form-btn"
                                th:onclick="|showReplyForm(${thread.postNumber})|" th:unless="${thread.isLocked()}">
                            <i class="reply icon"></i>
                        </button>
                        <form sec:authorize="hasRole(T(com.github.njuro.jboard.models.enums.UserRole).MODERATOR.getAuthority())"
                              style="display: inline" th:if="${iter.first}" method="post"
                              th:action="@{/board/{label}/{threadId}/sticky(label=${thread.board.label},threadId=*{postNumber})}">
                            <button class="circular mini ui basic icon button">
                                <i class="thumbtack icon"
                                   th:classappend="${thread.stickied} ? 'vertically flipped'"></i>
                            </button>
                        </form>
                        <form sec:authorize="hasRole(T(com.github.njuro.jboard.models.enums.UserRole).JANITOR.getAuthority())"
                              style="display: inline" th:if="${iter.first}" method="post"
                              th:action="@{/board/{label}/{threadId}/lock(label=${thread.board.label},threadId=*{postNumber})}">
                            <button class="circular mini ui basic icon button">
                                <i class="lock icon"
                                   th:classappend="${thread.locked} ? 'open'"></i>
                            </button>
                        </form>
                        <form sec:authorize="hasRole(T(com.github.njuro.jboard.models.enums.UserRole).MODERATOR.getAuthority())"
                              style="display: inline" method="post"
                              th:action="@{/board/{label}/{threadId}/delete/{postId}(label=${thread.board.label},threadId=${thread.postNumber},postId=*{postNumber})}">
                            <button class="circular mini ui basic icon button">
                                <i class="trash alternate icon"></i>
                            </button>
                        </form>
                        <i th:if="${iter.first and thread.stickied}"
                           class="thumbtack icon"></i>
                        <i th:if="${iter.first and thread.locked}"
                           class="lock icon"></i>
                    </div>
                    <div class="body" th:text="*{body}"></div>
                </div>
            </div>
        </div>
    </th:block>
</main>
</body>
</html>
